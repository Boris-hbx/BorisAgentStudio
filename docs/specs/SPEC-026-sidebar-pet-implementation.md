# SPEC-026: 侧边栏小宠物实现

> 作者: Boris Huai
> 起草日期: 2026-01-27
> 状态: 已完成

---

## 问题陈述 (Why)

用户希望为 BorisAgentStudio 的左侧导航栏添加一个可交互的小宠物组件，基于 SKILL-009 的设计。这个小宠物应该：
1. 增加界面的趣味性和个性化
2. 提供另一种折叠/展开侧边栏的交互方式
3. 通过呼吸效果让界面更有生命力

## 目标与成功标准 (DoD)

1. ✅ 实现 SidebarPet 组件，基于 SKILL-009 规格
2. ✅ 小宠物能跟随鼠标 Y 坐标移动
3. ✅ 点击小宠物可切换侧边栏折叠/展开状态
4. ✅ 实现呼吸效果动画（待机状态）
5. ✅ 颜色与整体页面色调协调（深色主题）
6. ✅ 尺寸适合现有侧边栏布局

## 非目标 (Out of Scope)

- 不实现躲避区域（avoidZones）功能
- 不实现 slim 瘦身状态
- 不支持移动端（桌面端专用）
- 不实现配置面板让用户自定义小宠物

---

## 技术方案 (How)

### 整体设计

小宠物是一个固定定位的元素，贴在侧边栏右边缘：

```
┌─────────────────────────────────────────────────────────┐
│  Sidebar                                                │
│  ┌───────────────────────────────────────────────────┐ │
│  │  Nav Items                                        │ │
│  ├───────────────────────────────────────────────────┤ │
│  │  Content                                          │ │
│  │                                   ┌───┐           │ │
│  │                                   │ O │ ← Pet     │ │
│  │                                   │ O │           │ │
│  │                                   │ O │           │ │
│  │                                   └───┘           │ │
│  ├───────────────────────────────────────────────────┤ │
│  │  Toggle Button                                    │ │
│  └───────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

### 组件结构

```typescript
// frontend/src/components/Sidebar/SidebarPet.tsx
interface SidebarPetProps {
  collapsed: boolean;
  onToggle: () => void;
}
```

### 状态机

| 状态 | 触发条件 | 视觉效果 |
|------|----------|----------|
| idle | 默认/鼠标离开后 | 呼吸动画（透明度变化） |
| active | 鼠标进入活动区域 | 眼睛变亮 |
| following | 鼠标移动中 | 跟随 Y 坐标 |
| excited | 快速追赶时 | 眼睛抖动 + 发光增强 |

### 尺寸规格

| 属性 | 值 | 说明 |
|------|-----|------|
| 宽度 | 16px | 精致小巧 |
| 高度 | 56px | 适合侧边栏比例 |
| 眼睛直径 | 6px | 3 只眼睛 |
| 眼睛间距 | 8px | 垂直排列 |

### 颜色规格

```css
/* 主体渐变 - 与 active 状态的 #8b5cf6 协调 */
background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);

/* 眼睛颜色 */
--eye-idle: rgba(255, 255, 255, 0.5);
--eye-active: #ffffff;
--eye-glow: 0 0 6px rgba(255, 255, 255, 0.6);

/* 发光效果 */
box-shadow: 0 0 12px rgba(139, 92, 246, 0.3);
```

### 动画参数

| 动画 | 属性 | 值 |
|------|------|-----|
| 呼吸 | 周期 | 3s |
| 呼吸 | 透明度 | 0.8 → 1.0 |
| 呼吸 | 缩放 | 1.0 → 1.02 |
| 跟随 | 缓慢缓动 | 0.08 |
| 跟随 | 急速缓动 | 0.25 |
| 回归 | 延迟 | 800ms |
| 回归 | 缓动 | 0.03 |

---

## 交互设计 (UX)

### 鼠标交互

1. **激活**：鼠标进入侧边栏 + 120px 区域内
2. **跟随**：小宠物平滑跟随鼠标 Y 坐标
3. **兴奋**：鼠标快速移动时，小宠物急速追赶，眼睛抖动
4. **回归**：鼠标离开 800ms 后，缓慢回到屏幕中央

### 点击交互

- 点击小宠物：切换侧边栏折叠/展开状态
- 悬停反馈：轻微放大 + 发光增强
- 点击反馈：缩小动画

### 键盘支持

- `Tab` 可聚焦
- `Enter` / `Space` 触发点击
- focus-visible 显示焦点环

---

## 风险清单与应对

| 风险 | 类型 | 等级 | 应对措施 | 决策理由 |
|------|------|------|----------|----------|
| RAF 未清理导致内存泄漏 | 技术 | 高 | useEffect 清理函数中 cancelAnimationFrame | 防止内存泄漏是基本要求 |
| 鼠标事件频繁影响性能 | 技术 | 中 | 仅在活动区域内更新目标位置 | 减少不必要的计算 |
| 深色主题可见性不足 | 技术 | 中 | 使用 box-shadow glow 效果 | 确保深色背景下可见 |
| 小宠物遮挡内容 | 体验 | 中 | z-index: 100，不超过 tooltip | 平衡可见性和不遮挡 |
| 用户不知可点击 | 体验 | 中 | cursor: pointer + 悬停放大 | 明确可交互状态 |
| 动画分散注意力 | 体验 | 低 | 3s 周期，微妙变化幅度 | 趣味性与专注的平衡 |

---

## 决策记录 (Decision Log)

### D1: 尺寸选择

**决策**：宽度 16px，高度 56px

**理由**：
1. 比 SKILL-009 的 24×80 更小巧，适合信息密集的工具界面
2. 高度 56px 与折叠态侧边栏宽度一致，视觉协调
3. 不会过于显眼影响主内容区

**替代方案**：24×80（SKILL-009 原尺寸）- 过于抢眼

### D2: 颜色方案

**决策**：紫色渐变 (#667eea → #764ba2)

**理由**：
1. 与现有 active 状态的 #8b5cf6 同色系
2. 深色主题下有足够对比度
3. 渐变效果增加层次感

**替代方案**：
- 白色半透明 - 太平淡
- 绿色渐变 - 与 success 状态冲突

### D3: 呼吸动画幅度

**决策**：透明度 0.8-1.0，缩放 1.0-1.02

**理由**：
1. 微妙变化不分散注意力
2. 3s 周期足够缓慢，不产生焦虑感
3. 保持"活着"的感觉

**替代方案**：更大幅度（0.5-1.0）- 太过明显

---

## 产出物

| 产出 | 位置 |
|------|------|
| SidebarPet 组件 | `frontend/src/components/Sidebar/SidebarPet.tsx` |
| SidebarPet 样式 | `frontend/src/components/Sidebar/SidebarPet.css` |
| Spec 文档 | `docs/specs/SPEC-026-sidebar-pet-implementation.md` |
| Session 日志 | `data/sessions/2026-01-27-002-sidebar-pet-implementation.json` |

---

## 参考

- SKILL-009-sidebar-pet.json
- SPEC-025-sidebar-pet-skill.md
- Sidebar.tsx（集成点）
