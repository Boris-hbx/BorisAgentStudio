# SPEC-031: HarmonyStudio - UI 卡片格式转换

> 作者: Boris Huai
> 起草日期: 2026-01-28
> 状态: 实施中

## 1. 问题陈述 (Why)

用户有一个基于 LLM 的 **UI 卡片图像转 Vue 代码** 的工作流实践（来自 HarmonyOS 生态）。希望将此能力集成到 BorisAgentStudio 中，实现：

1. **功能展示**：展示 LLM 在 UI 逆向工程中的能力
2. **实用工具**：提供真正可用的图片转 HTML 功能
3. **可视化结果**：在 Web 页面上查看转换输入、输出和效果

## 2. 目标与成功标准 (DoD)

| # | 目标 | 验收标准 |
|---|------|----------|
| 1 | 左侧栏新增 HarmonyStudio 入口 | 可点击进入功能页面 |
| 2 | 展示现有样例 | 可查看输入图片、输出数据、渲染效果 |
| 3 | `/cardtransfer` command | 执行后 Claude 读取图片并输出转换结果 |
| 4 | SKILL 规范 | 生成 SKILL 文件记录转换规则 |

## 3. 非目标 (Out of Scope)

- ❌ 不通过 API 调用 LLM（由 Claude Code 对话式处理）
- ❌ 不实现图片上传功能（通过命令行指定路径）
- ❌ 不实现 Vue 渲染引擎（展示截图或 HTML 代码）
- ❌ 不接入 HarmonyOS 真实组件库

## 4. 技术方案 (How)

### 4.1 系统架构

```
┌─────────────────────────────────────────────────────────────────┐
│  用户                                                           │
│    │                                                            │
│    ├── /cardtransfer <图片路径>                                 │
│    │         │                                                  │
│    │         ▼                                                  │
│    │   ┌─────────────┐                                         │
│    │   │ Claude Code │ ──读取图片──▶ 分析 UI ──▶ 输出 JSON    │
│    │   └─────────────┘                                         │
│    │                                                            │
│    └── Web 页面查看                                             │
│              │                                                  │
│              ▼                                                  │
│        ┌──────────────┐                                        │
│        │HarmonyStudio │                                        │
│        │  - 样例展示   │                                        │
│        │  - 三栏预览   │                                        │
│        └──────────────┘                                        │
└─────────────────────────────────────────────────────────────────┘
```

### 4.2 组件结构

```
frontend/src/components/HarmonyStudio/
├── HarmonyStudio.tsx      # 主组件
├── HarmonyStudio.css      # 样式
└── index.ts               # 导出

frontend/src/services/
└── harmonySamples.ts      # 样例数据

frontend/public/harmony-samples/
├── *-input.png            # 输入图片
└── *-output.png           # 渲染效果截图
```

### 4.3 Command 设计

位置：`.claude/commands/cardtransfer.md`

功能：
1. 读取指定路径的图片
2. 基于 SKILL-010 规范分析图片
3. 输出 `{data, html}` JSON 结构

### 4.4 SKILL 设计

位置：`skills/harmony/SKILL-010-card-transfer.json`

包含：
- 标签约束
- 样式约束
- 布局约束
- 数据绑定规范
- 自定义组件定义

## 5. 交互设计 (UX)

### 5.1 导航入口

在左侧 Sidebar 添加 HarmonyStudio 模块：
- 图标：🎨
- 标签：HarmonyStudio
- 位置：Agent 展示之后

### 5.2 页面布局

```
┌─────────────────────────────────────────────────────────────┐
│  HarmonyStudio - UI 卡片格式转换                            │
├─────────────────────────────────────────────────────────────┤
│  [样例选择器]                                               │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐          │
│  │华为音乐 │ │体育赛事 │ │快递服务 │ │浏览器   │          │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘          │
├─────────────────────────────────────────────────────────────┤
│  [Tab 切换]                                                 │
│  ┌─────────┬─────────┬─────────┐                           │
│  │ 输入图片 │ 提取数据 │ 渲染效果 │                           │
│  └─────────┴─────────┴─────────┘                           │
├─────────────────────────────────────────────────────────────┤
│  [预览区]                                                   │
│                                                             │
│       （根据选中 Tab 显示对应内容）                          │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  [工作流展示]                                               │
│  图片 → LLM 分析 → 数据 + HTML → 渲染                       │
└─────────────────────────────────────────────────────────────┘
```

## 6. 风险与应对

| 风险 | 严重度 | 应对 |
|------|--------|------|
| 图片路径含中文空格 | 中 | 样例数据重命名为英文 |
| HTML 渲染安全性 | 低 | 仅展示截图，不实时渲染 |
| 转换准确性 | 中 | 提供详细规范约束 LLM 输出 |

## 7. 决策记录

| 决策 | 选项 | 最终选择 | 理由 |
|------|------|----------|------|
| LLM 调用方式 | API / 对话式 | 对话式 | 利用 Claude Code 现有能力，无需额外集成 |
| 结果展示 | 实时渲染 / 截图 | Tab 切换 | 简单安全，避免 Vue 依赖 |
| 样例数据存储 | data/ / public/ | public/ | 方便前端直接引用 |

## 8. 文件清单

| 文件 | 类型 | 说明 |
|------|------|------|
| `frontend/src/components/HarmonyStudio/` | 组件 | UI 组件 |
| `frontend/src/services/harmonySamples.ts` | 服务 | 样例数据 |
| `frontend/public/harmony-samples/` | 资源 | 图片资源 |
| `.claude/commands/cardtransfer.md` | Command | 转换命令 |
| `skills/harmony/SKILL-010-card-transfer.json` | Skill | 转换规范 |

## 9. 后续演进

1. **阶段二**：支持转换结果保存到 `data/harmony-outputs/`
2. **阶段三**：Web 端支持图片上传
3. **阶段四**：集成 Vue 预览组件实现实时渲染
