# RULE-007: 任务完成 Checklist

> 作者: Claude (自我反思产出)
> 起草日期: 2026-01-27
> 状态: 实施中

## 背景

多次发生"忘记记录 session 日志"的情况。根本原因是把日志当成"事后记录"而非"任务的一部分"。

## 规则

### 任务开始时

对于非 trivial 任务（涉及多文件修改、功能实现、设计变更），**必须**使用 TaskCreate 创建任务列表，且列表**必须包含**：

```
[ ] 主要任务...
[ ] 记录 session 日志
```

### 任务结束前

在宣布任务完成前，**必须**检查以下 checklist：

| 检查项 | 适用条件 | 必须？ |
|--------|----------|--------|
| 代码编译/测试通过 | 涉及代码修改 | ✓ |
| Session 日志已记录 | 多文件修改、功能实现、设计变更 | ✓ |
| Spec 已更新 | 涉及设计决策 | ✓ |
| Skill 已更新 | 涉及可复用能力 | 可选 |

### 日志记录时机

**正确**：边做边记（工具调用完成后立即记录）
**错误**：全部做完再补记

### 简化方案

如果担心忘记，可以在每次工具调用后，立即在 scratch 中追加记录：

```
// 工具调用记录（稍后整理为正式日志）
tc_001: Read particle.ts -> 读取粒子类型定义
tc_002: Read engine.ts -> 读取物理引擎
...
```

## 触发条件（Non-trivial 任务定义）

**满足以下任意一条 → 必须记录日志**：

| 维度 | 阈值 |
|------|------|
| 文件数量 | 修改 ≥ 2 个文件 |
| 代码行数 | 修改 ≥ 50 行 |
| 工具调用 | 使用 ≥ 5 次工具 |
| 任务类型 | 功能实现、bug 修复、重构、设计变更 |
| 决策 | 涉及技术选型或设计决策 |
| 触发方式 | `/team` 命令触发 |

## 豁免条件（Trivial 任务）

**以下情况可以不记录**：

| 场景 | 示例 |
|------|------|
| 问答 | "这个函数是做什么的？" |
| 单文件小改 | 修复 typo、调整一个参数（< 20 行） |
| 查找 | "帮我找一下 xxx 文件" |
| 解释 | "解释一下这段代码" |
| 用户要求 | 用户明确说不需要记录 |

## 违反后果

如果用户指出忘记记录日志：

1. 立即补记
2. 在日志中添加 `reflection` 字段，记录为什么忘记
3. 检查是否需要更新本规则

## 参考

- STD-001: Agent Session 日志记录标准
- CLAUDE.md: Agent 日志记录章节
