# SPEC-005: 布局优化 - 解决内容遮盖问题

> 作者: Boris Huai
> 起草日期: 2026-01-25
> 状态: 草稿

---

## 问题描述

当前布局存在两个遮盖问题：

### 问题 1：时序图节点展开时工具列表被遮盖

**现象**：展开"执行"阶段时，工具列表（Edit、Write 等标签）超出节点边界，被相邻节点或箭头遮盖。

**原因**：
- 节点使用固定 `max-width`，内容溢出时被 `overflow: hidden` 截断
- 时序图横向排列，相邻元素层叠顺序（z-index）未处理

### 问题 2：详情面板占据过多空间

**现象**：底部详情面板固定高度 `max-height: 50vh`，导致上方内容区域只有很窄的可视空间。

**原因**：
- 详情面板始终固定在底部
- 没有折叠/最小化功能
- 时序图和上下文流转图被压缩

---

## 设计目标

1. 节点展开时内容完整可见，不被遮盖
2. 详情面板可调整大小，不影响主视图
3. 保持单页全景布局原则

---

## 方案设计

### 方案 A：弹出式详情（推荐）

**时序图节点**：
- 展开的节点使用 `position: relative` + `z-index` 提升层级
- 或改为悬浮卡片（tooltip/popover）展示详细信息

**详情面板**：
- 改为右侧抽屉式，不占用垂直空间
- 或改为模态弹窗，按需显示

```
┌─────────────────────────────────────────────────────────────────┐
│  Header                                                         │
├─────────────────────────────────────────────────────────────────┤
│  StatusBar                                                      │
├─────────────────────────────────────────────────────────────┬───┤
│                                                             │   │
│  ┌─────────────────────────────────────────────────────┐    │ D │
│  │           时序图 (完整高度)                          │    │ e │
│  │   [理解] → [探索] → [规划] → [执行] → [验证]        │    │ t │
│  └─────────────────────────────────────────────────────┘    │ a │
│                                                             │ i │
│  ┌─────────────────────────────────────────────────────┐    │ l │
│  │           上下文流转图                               │    │   │
│  └─────────────────────────────────────────────────────┘    │   │
│                                                             │   │
└─────────────────────────────────────────────────────────────┴───┘
```

### 方案 B：可折叠底部面板

**详情面板**：
- 添加折叠/展开按钮
- 折叠时只显示标题栏（约 40px）
- 展开时高度可拖拽调整

**时序图节点**：
- 展开的节点添加 `z-index: 10`

---

## 推荐方案：A + 节点 z-index 修复

### 1. 节点展开层级修复

```css
.timeline-node.expanded {
  z-index: 10;
  position: relative;
}

.timeline-item {
  position: relative;
  z-index: 1;
}

/* 确保展开的节点在最上层 */
.timeline-item:has(.timeline-node.expanded) {
  z-index: 10;
}
```

### 2. 详情面板改为右侧抽屉

```
宽度: 400px (可调整)
位置: 右侧固定
触发: 双击节点或点击"查看详情"
关闭: 点击 X 或点击遮罩层
```

**布局变化**：
- 主内容区域 `margin-right: 400px`（面板打开时）
- 面板使用 `position: fixed; right: 0`

### 3. 备选：模态弹窗

如果右侧抽屉实现复杂，可简化为居中模态弹窗：

```
宽度: 80vw, max-width: 900px
高度: 80vh
位置: 屏幕居中
背景: 半透明遮罩
```

---

## 实现步骤

1. **修复节点 z-index** - 优先级高，改动小
2. **重构 DetailPanel** - 改为右侧抽屉或模态弹窗
3. **调整主布局** - App.css 适配新的面板位置
4. **测试响应式** - 确保小屏幕下正常显示

---

## 验收标准

- [ ] 展开任意阶段节点，内容完整可见
- [ ] 详情面板不遮挡时序图和上下文流转图
- [ ] 关闭详情面板后，主视图恢复完整
- [ ] 小屏幕（<1200px）布局正常

---

## 相关文档

- [SPEC-002: 可视化界面设计](./SPEC-002-visualization-design.md)
- 截图: `data/prtsc/Screenshot 2026-01-25 060244.png`
